<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ch√∫c m·ª´ng sinh nh·∫≠t b√© Yena üéÇ</title>
  <style>
    :root{--bg:#0b0b0f;--overlay-bg:rgba(2,6,23,.88);--card:#fff;--accent:#ffd6ea}
    html,body{height:100%;margin:0;font-family:'Poppins',system-ui,Arial,sans-serif;background:var(--bg);color:#222}

    /* STAGE (hidden until overlay dismissed) */
    #stage{display:none;min-height:100vh;padding:28px;box-sizing:border-box;position:relative;overflow:hidden}
    header{display:flex;gap:16px;align-items:center}
    .avatar{width:96px;height:96px;border-radius:18px;background:linear-gradient(135deg,#fff,#f9f9ff);display:grid;place-items:center;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    h1{margin:0;font-size:28px;color:#fff}
    p.lead{margin:6px 0 0;color:#e6e9ef}

    /* Floating icons in background */
    .float-wrap{position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:1}
    .float-wrap i{position:absolute;font-size:26px;opacity:.9;transform:translateY(0);will-change:transform,opacity}
    @keyframes floatUp{from{transform:translateY(40vh) scale(.9);opacity:0}50%{opacity:1}to{transform:translateY(-20vh) scale(1.1);opacity:0}}

    /* cards */
    main{display:flex;flex-wrap:wrap;gap:18px;position:relative;z-index:2}
    .card{background:rgba(255,255,255,0.06);backdrop-filter:blur(6px);padding:18px;border-radius:14px;color:#fff;min-width:240px}

    /* OVERLAY */
    #overlay{position:fixed;inset:0;background:var(--overlay-bg);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:200}
    .cake-wrap{position:relative;display:flex;align-items:center;justify-content:center;flex-direction:column}
    .cake-img{width:320px;max-width:78vw;border-radius:18px;box-shadow:0 30px 80px rgba(0,0,0,.6)}

    /* Candle glow effect */
    .glow{position:absolute;left:50%;top:40%;transform:translate(-50%,-50%);width:220px;height:220px;border-radius:50%;pointer-events:none;filter:blur(30px);mix-blend-mode:screen;opacity:1}
    .flame-spot{position:absolute;left:50%;top:28%;transform:translate(-50%,-50%);width:28px;height:42px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff5b8,#ffd06a,#ff7b6b);box-shadow:0 0 40px #ffb86b,0 0 90px rgba(255,140,180,.25)}

    .instruction{color:#fff;margin-top:18px;font-size:18px}

    /* subtle pulse on cake to invite click */
    .cake-wrap{animation:invite 2.6s infinite}
    @keyframes invite{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}

    /* small responsive tweaks */
    @media(max-width:520px){.cake-img{width:260px}}
  </style>
</head>
<body>

  <!-- Overlay: dark, centered cake image (user file: cakee.png) -->
  <div id="overlay" role="dialog" aria-label="M·ªü ƒë·∫ßu sinh nh·∫≠t">
    <div class="cake-wrap" id="cakeWrap" tabindex="0">
      <!-- user should provide cakee.png in same folder -->
      <img src="cakee.png" alt="B√°nh sinh nh·∫≠t" class="cake-img" id="cakeImg" />
      <div class="glow" id="glow" style="background: radial-gradient(circle at 50% 40%, rgba(255,220,240,0.45) 0%, rgba(255,200,240,0.18) 15%, rgba(0,0,0,0) 40%);"></div>
      <div class="flame-spot" id="flameSpot"></div>
    </div>
    <div class="instruction">Nh·∫•p v√†o b√°nh ƒë·ªÉ th·ªïi n·∫øn ‚ú®</div>
  </div>

  <!-- Main stage (hidden until overlay closed) -->
  <div id="stage">
    <div class="float-wrap" id="floatWrap" aria-hidden="true"></div>

    <header>
      <div class="avatar" aria-hidden>
        <svg width="72" height="72" viewBox="0 0 86 86" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="43" cy="54" rx="28" ry="18" fill="#fff9fb" stroke="#f4d9f0"/>
          <circle cx="29" cy="36" r="10" fill="#fff" stroke="#f4d9f0"/>
          <circle cx="57" cy="36" r="10" fill="#fff" stroke="#f4d9f0"/>
          <circle cx="34" cy="36" r="3" fill="#2b2b2b"/>
          <circle cx="52" cy="36" r="3" fill="#2b2b2b"/>
          <path d="M38 46c3 3 10 3 12 0" stroke="#2b2b2b" stroke-linecap="round" stroke-width="2"/>
        </svg>
      </div>
      <div>
        <h1>Ch√∫c m·ª´ng sinh nh·∫≠t Yena!</h1>
        <p class="lead">M·ªôt ng√†y ƒë·∫∑c bi·ªát ‚Äî ch√∫c b√© lu√¥n h·∫°nh ph√∫c v√† kh·ªèe m·∫°nh üíñ</p>
      </div>
    </header>

    <main>
      <div class="card">
        <h3>L·ªùi ch√∫c</h3>
        <p>Yena ∆°i, h√¥m nay l√† ng√†y c·ªßa con‚Äîch√∫c con th·∫≠t nhi·ªÅu ni·ªÅm vui v√† b√°nh kem!</p>
      </div>
      <div class="card">
        <h3>Qu√†</h3>
        <p>Trang web nh·ªè xinh n√†y d√†nh ri√™ng cho con. H√£y kh√°m ph√° nh√©!</p>
      </div>
    </main>
  </div>

  <!-- Audio: puff sound (on blow) and birthday song (child voice) -->
  <audio id="puffSound" src="puff.mp3" preload="auto"></audio>
  <audio id="song" src="happy_korean_child.mp3" preload="auto"></audio>

  <script>
    // Elements
    const overlay = document.getElementById('overlay');
    const cakeWrap = document.getElementById('cakeWrap');
    const flameSpot = document.getElementById('flameSpot');
    const glow = document.getElementById('glow');
    const stage = document.getElementById('stage');
    const puff = document.getElementById('puffSound');
    const song = document.getElementById('song');
    const floatWrap = document.getElementById('floatWrap');

    let lit = true;

    // Play puff + extinguish effect
    function extinguish(){
      if(!lit) return;
      lit = false;
      // play puff sound (if provided)
      try{puff.currentTime = 0; puff.play().catch(()=>{});}catch(e){}

      // small visual: shrink flame spot + fade glow
      flameSpot.style.transition = 'transform .45s ease, opacity .45s ease';
      flameSpot.style.transform = 'translate(-50%,-50%) scale(.25)';
      flameSpot.style.opacity = '0';
      glow.style.transition = 'opacity .6s ease, transform .6s ease';
      glow.style.opacity = '0';

      // hide overlay after animation
      setTimeout(()=>{
        overlay.style.display = 'none';
        stage.style.display = 'block';
        startBackground();
        // start song (user interaction happened so autoplay allowed)
        try{song.currentTime = 0; song.play().catch(()=>{});}catch(e){}
      },650);
    }

    // Click / keyboard
    cakeWrap.addEventListener('click', extinguish);
    cakeWrap.addEventListener('keydown', (e)=>{ if(e.code === 'Space' || e.key === 'Enter') extinguish(); });

    // Create floating icons
    const icons = ['üéà','üíñ','‚ú®','‚≠ê','üéÄ'];
    function spawnIcon(i){
      const el = document.createElement('i');
      el.textContent = icons[Math.floor(Math.random()*icons.length)];
      const size = 18 + Math.random()*26; el.style.fontSize = size+'px';
      el.style.left = (10 + Math.random()*80) + '%';
      el.style.bottom = '-10%';
      const delay = Math.random()*4;
      const duration = 8 + Math.random()*8;
      el.style.animation = `floatUp ${duration}s linear ${delay}s forwards`;
      floatWrap.appendChild(el);
      setTimeout(()=>{ el.remove(); }, (delay+duration)*1000 + 200);
    }
    let floatInterval;
    function startBackground(){
      // spawn a few immediately
      for(let i=0;i<8;i++) spawnIcon();
      floatInterval = setInterval(()=>spawnIcon(), 900);
    }

    // Accessibility: if audio files missing, ignore errors
    song.addEventListener('error', ()=>{console.warn('Kh√¥ng t√¨m th·∫•y file happy_korean_child.mp3 ‚Äî vui l√≤ng t·∫£i file l√™n c√πng th∆∞ m·ª•c n·∫øu mu·ªën b√†i h√°t.');});
    puff.addEventListener('error', ()=>{console.warn('Kh√¥ng t√¨m th·∫•y file puff.mp3 ‚Äî vui l√≤ng t·∫£i file l√™n c√πng th∆∞ m·ª•c n·∫øu mu·ªën ti·∫øng ph√π.');});

    // Preload: gently animate flame to attract attention
    flameSpot.animate([
      { transform: 'translate(-50%,-50%) scale(1)', opacity:1 },
      { transform: 'translate(-50%,-55%) scale(1.05)', opacity:1 },
      { transform: 'translate(-50%,-50%) scale(1)', opacity:1 }
    ],{duration:1400,iterations:Infinity,easing:'ease-in-out'});

    // Optional: allow blow detection via mic (try to detect strong RMS)
    // This is best-effort; if user doesn't allow, it fails silently.
    async function tryMicBlow(){
      if(!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return;
      try{
        const stream = await navigator.mediaDevices.getUserMedia({audio:true});
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        const ctx = new AudioCtx();
        const src = ctx.createMediaStreamSource(stream);
        const analyser = ctx.createAnalyser(); analyser.fftSize = 2048;
        const data = new Uint8Array(analyser.fftSize);
        src.connect(analyser);
        function check(){
          analyser.getByteTimeDomainData(data);
          let sum=0; for(let i=0;i<data.length;i++){const v=(data[i]-128)/128; sum+=v*v}
          const rms = Math.sqrt(sum/data.length);
          if(rms > 0.09 && lit){ extinguish(); stream.getTracks().forEach(t=>t.stop()); ctx.close(); }
          if(lit) requestAnimationFrame(check);
        }
        check();
      }catch(e){/* ignore mic errors */}
    }

    // Try mic after first user interaction (click) - not before to avoid auto prompt
    cakeWrap.addEventListener('click', ()=>{ tryMicBlow(); });

    // Helpful notice when DOM ready
    document.addEventListener('DOMContentLoaded', ()=>{
      // nothing - overlay visible by default
    });

  </script>
</body>
</html>
